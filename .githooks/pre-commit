#!/bin/sh

printf "\n\n"
echo "******************* PRE COMMIT HOOK STARTED ***********************"
printf "\n\n"

npm ci

CHANGED_UNIT_TEST_FILES=($(npm run --silent unit:test:list:recent))

if [[ ${#CHANGED_UNIT_TEST_FILES[@]} -gt 1 ]]; then
    echo "Unit Tests:"
    printf '%s\n' "${CHANGED_UNIT_TEST_FILES[@]}" 
    npm run unit:test:recent
fi

CHANGED_DATABASE_TEST_FILES=($(npm run --silent database:test:list:recent))

if [[ ${#CHANGED_DATABASE_TEST_FILES[@]} -gt 1 ]]; then
    echo "Database Tests:"
    printf '%s\n' "${CHANGED_DATABASE_TEST_FILES[@]}" 
    npm run database:test:recent
fi

TEST_RESULT=$?

printf "\n\n"
echo "******************* PRE COMMIT HOOK FINISHED ***********************"
printf "\n\n"

if [ $TEST_RESULT -gt 0 ]; then
    exit 1
fi

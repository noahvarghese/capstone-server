name: "Continuous Integration"
description: "continuous integration"
runs:
  using: composite
  steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - uses: actions/setup-python@v2
    - uses: actions/setup-node@v2
    - name: install python dependencies
      run: pip install -r ./bin/database/requirements.txt
      shell: bash
    - name: install node dependencies
      run: npm ci
      shell: bash
    - id: changed
      name: "Get changed"
      uses: "./.github/actions/changed"
    - name: "List changed unit tests"
      run: |
        npm run unit:test:list -- --changedSince "${{ steps.changed.outputs.changed }}"
      shell: bash
    - name: "List changed integration tests"
      run: |
        npm run integration:test:list -- --changedSince "${{ steps.changed.outputs.changed }}""
      shell: bash
    - name: "List changed database tests"
      run: |
        npm run database:test:list -- --changedSince "${{ steps.changed.outputs.changed }}"
      shell: bash
    - id: cache-node-modules
      uses: ./.github/actions/cache-node-modules
    - name: test
      run: |
        npm run unit:test -- --changedSince "${{ steps.changed.outputs.changed }}"
      shell: bash